<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>Custom Infinite Vertical Scroller</title>

  <style>
    /**
     * Scoped CSS for #customScroller only.
     * Defines width:500px, height:360px, and custom variables for speed/duration.
     */
    #customScroller {
      --scroller-item-height: 1lh;            /* 1× line-height */
      --scroller-mask-top: 0.25lh;
      --scroller-mask-bottom: 0.25lh;
      --scroller-mask-center: 0.5lh;
      --indicator-border-thickness: 0.05em;
      --indicator-corner: 0.175em;
      --indicator-transition: 0.25s;
      --indicator-hue: 320;                    /* initial hue */
      --item-duration: 6;                      /* scroll duration (seconds) */
      --item-delay: 1;                         /* delay before scroll starts (seconds) */
      --highlight-ease: elastic.out(1, 0.875);

      position: relative;
      width: 500px;
      height: 360px;
      background: #000; /* forced dark background */
      overflow: hidden;
      font-family: Impact, Haettenschweiler, 'Arial Narrow Bold',
        sans-serif;
    }

    /* Container that holds the indicator and the list */
    #customScroller .scroller-container {
      --font-level: 8;
      opacity: 0;
      height: calc(var(--scroller-item-height) * 3);
      display: flex;
      align-items: center;
      justify-content: center;
      /* Mask to fade top and bottom */
      mask: linear-gradient(
        #0000  var(--scroller-mask-top),
        #fff    calc(50% - var(--scroller-mask-center)),
        #fff    calc(50% + var(--scroller-mask-center)),
        #0000  calc(100% - var(--scroller-mask-bottom))
      );
      color: color-mix(in lch, canvasText, canvas 15%);
      text-align: center;
      position: relative;
      width: 100%;
      height: 100%;
    }

    /* The scrolling list */
    #customScroller .scroller-list {
      padding: 0;
      margin: 0;
      list-style: none;
      text-transform: uppercase;
      line-height: 1;
      height: var(--scroller-item-height);
      display: inline-grid;
      position: relative;
      padding-inline: 0.25em;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    /* Indicator box around the visible word */
    #customScroller .scroller-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      height: var(--scroller-item-height);
      transform: translate(-50%, -50%);
      border: var(--indicator-border-thickness) solid
        oklch(0.75 1 var(--indicator-hue));
      transition: width var(--indicator-transition),
                  border-color var(--indicator-transition);
      width: calc((var(--width) * 1px) + var(--indicator-corner));

      /* Rounded‐corner mask */
      clip-path: polygon(
        0 0,
        var(--indicator-corner) 0,
        var(--indicator-corner) var(--indicator-corner),
        0 var(--indicator-corner),
        0 100%,
        0 calc(100% - var(--indicator-corner)),
        var(--indicator-corner) calc(100% - var(--indicator-corner)),
        var(--indicator-corner) 100%,
        0 100%,
        calc(100% - var(--indicator-corner)) 100%,
        calc(100% - var(--indicator-corner)) calc(100% - var(--indicator-corner)),
        100% calc(100% - var(--indicator-corner)),
        100% 100%,
        100% var(--indicator-corner),
        calc(100% - var(--indicator-corner)) var(--indicator-corner),
        calc(100% - var(--indicator-corner)) 0,
        100% 0,
        100% 100%,
        0 100%
      );
    }

    /* Each list item */
    #customScroller .scroller-item {
      display: inline-block;
      width: fit-content;
      height: var(--scroller-item-height);
      grid-area: 1 / 1;
      line-height: 1.2;
    }
  </style>
</head>

<body>
  <!----------------------- Custom Scroller Markup ----------------------->
  <div id="customScroller">
    <div class="scroller-container">
      <div class="scroller-indicator"></div>
      <ul class="scroller-list">
        <li class="scroller-item">prototype.</li>
        <li class="scroller-item">solve.</li>
        <li class="scroller-item">build.</li>
        <li class="scroller-item">develop.</li>
        <li class="scroller-item">debug.</li>
        <li class="scroller-item">learn.</li>
        <li class="scroller-item">cook.</li>
        <li class="scroller-item">ship.</li>
        <li class="scroller-item">prompt.</li>
        <li class="scroller-item">collaborate.</li>
        <li class="scroller-item">create.</li>
        <li class="scroller-item">inspire.</li>
        <li class="scroller-item">follow.</li>
        <li class="scroller-item">innovate.</li>
        <li class="scroller-item">test.</li>
        <li class="scroller-item">optimize.</li>
        <li class="scroller-item">teach.</li>
        <li class="scroller-item">visualize.</li>
        <li class="scroller-item">transform.</li>
        <li class="scroller-item">scale.</li>
        <li class="scroller-item">do it.</li>
      </ul>
    </div>
  </div>

  <script type="module">
    import gsap from 'https://cdn.skypack.dev/gsap@3.12.0';

    // Read durations from CSS variables
    const rootStyles = getComputedStyle(document.getElementById('customScroller'));
    const itemDuration = parseFloat(rootStyles.getPropertyValue('--item-duration'));
    const itemDelay    = parseFloat(rootStyles.getPropertyValue('--item-delay'));
    const highlightEase = rootStyles.getPropertyValue('--highlight-ease');

    gsap.defaults({ duration: 1 });

    // Create a paused timeline for each <li>
    const tl = gsap.timeline({ paused: true });
    const lines = gsap.utils.toArray('#customScroller .scroller-item');

    // Initially place each <li> off-screen (below) by 300% of its own height
    gsap.set('#customScroller .scroller-item', { yPercent: 300 });

    // Duplicate the array so it can loop seamlessly
    const paddedLines = [...lines, ...lines, ...lines];

    paddedLines.forEach((line, index) => {
      const lineTl = gsap.timeline()
        .set(line, { yPercent: 300 })
        .to(
          line,
          {
            yPercent: '-=600',
            repeatRefresh: true,
            immediateRender: false,
            ease: 'none',
            duration: itemDuration,
          },
          0
        );
      tl.add(lineTl, index);
    });

    // Create a “scrubber” timeline that drives the totalTime of tl
    const scrubber = gsap.timeline({ paused: true }).fromTo(
      tl,
      {
        totalTime: lines.length + 1,
      },
      {
        totalTime: lines.length * 2 + 1,
        ease: 'none',
        duration: lines.length,
        repeat: -1,
      }
    );

    // Seed the scrubber’s starting position so items start halfway
    gsap.set(scrubber, { totalTime: lines.length + 2 });

    // The “indicator” must wrap exactly around the currently visible word
    let indexCounter = 0;
    const indicator = document.querySelector('#customScroller .scroller-indicator');
    gsap.set(indicator, {
      '--width': lines[0].getBoundingClientRect().width,
    });

    const syncIndicator = () => {
      indexCounter += 1;
      const nextWidth = lines[indexCounter % lines.length].getBoundingClientRect().width;
      // Randomize hue
      const newHue = Math.floor(Math.random() * 360);
      indicator.style.setProperty('--width', `${nextWidth}`);
      indicator.style.setProperty('--indicator-hue', newHue);
    };

    gsap.to(scrubber, {
      delay: itemDelay,
      totalTime: '+=1',
      duration: 1,
      repeat: -1,
      repeatDelay: 1,
      repeatRefresh: true,
      onStart: syncIndicator,
      onRepeat: syncIndicator,
      ease: highlightEase,
    });

    // Fade the scroller container in
    gsap.set('#customScroller .scroller-container', { opacity: 1 });
  </script>
</body>
</html>
